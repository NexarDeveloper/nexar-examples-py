# nexar-examples-py
Various example Nexar queries to use as inspiration for developing custom partner applications

## Obtaining Tokens
Each example in this repository will require an access token. Tokens can be generated by using the print_token.py program from the nexar-token-py repository:

`python print_token.py <client_id> <client_secret> supply.domain`

`python print_token.py <client_id> <client_secret> user.access design.domain`

The client_id and client_secret fields are found within the application details section from https://nexar.com/applications. The "supply.domain" scope is for applications that use queries prefixed with "sup" while "design.domain" (usually with "user.access" included) is for applications that require an Altium workspace resource used by queries/mutations that are prefixed with "des". The "design.domain" token will require an additional step in the authorization process that will open a web browser page to collect username and password credentials for the Altium workspace.

We recommend capturing the output from these programs in a shell variable for use with these example programs.  The token can be used as part of the command line arguments as shown here:

`python workspace_info.py -t $token <name>`

The primary advantage of capturing the token in a shell variable is the ability to re-use the token for multiple runs of these examples without having to regenerate the token for each invocation. Tokens may also be generated directly in the code using the nexar-token-py repository by importing it as a submodule/subtree and adding the following to your application:

`from nexar_module.nexar_token import get_token`

and then calling the get_token function with the required credentials (see the README file in the nexar-token-py repository for details).

All tokens are time limited (typically for 24 hours) and new tokens will be needed after expiration.

## Nexar queries
All Nexar queries are baesed on the GraphQL query language.  The examples in this repository typically begin by defining a query string and then calling a Nexar client with that string and some variable definitions to target the query to a specific dataset.  For more information about the GraphQL language please visit https://graphql.org.  For information about the structure of the Nexar schema please visit https://api.nexar.com/ui/voyager.

## A simple part search
The mpn_info.py example queries for information related to a manufacturers part number (MPN):

`python mpn_info.py -t $token <mpn>`

Since this example uses only supply scope data (queries prefixed with "sup") the get_token/print_token.py generator should be used for a token that must include the scope for "supply.domain". The output will be similar to this:

\{\
 "results": \[\
  \{\
   "part": \{\
    "category": \{\
     "parentId": "4850",\
     "id": "4858",\
     "name": "Signal Relays",\
     "path": "/electronic-parts/electromechanical/relays/signal-relays"\
    \},\
    "mpn": "1-1415898-1",\
    "manufacturer": \{\
     "name": "TE Connectivity / AMP"\
    \},\
    "shortDescription": "Electromechanical Relay 48VDC 5.52KOhm 16A SPST-NO (29x12.7x15.7)mm THT Power Relay",\
    "descriptions": \[\
...

The output is a string dump of the JSON structure returned by the Nexar query.  The content of this structure can be customized by editing the string QUERY_MPN in the source code.  Try adding or removing fields to this query to observe the effect on the returned structure.

## Advanced part searching

The mpn_pricing_to_csv.py is a more sophisticated example of using Nexar to request information from multiple part numbers (MPN) with a single query:

`python mpn_pricing_to_csv.py -t $token <mpn> <second mpn> <third mpn> ...`

The query resuts are then processed into a csv output meant to display a table of distributors and prices for each mpn.

## A365 workspace details
The workspace_info.py example is a simple query of an Altium A365 workspace with the workspace name given as the required argument:

`python workspace_info.py -t $token <name>`

Since this example uses A365 resources the get_token/print_token.py generator should be used with the "design.domain" scope (a typcially token would also include "user.access" and even "supply.domain" if part queries are to be included). The output will be similar to this:

\[\
 \{\
  "url": "https://nexar-demo.365.altium.com/", \
  "name": "Nexar Demo",\
  "description": "This workspace is configured to support demonstrations of A365/Nexar to Altium partners",\
  "projects": \[\
   \{\
    "id": "RGVzUHJvamVjdApkaHR0cHM6Ly9uZXhhci1kZW1vLjM2NS5hbHRpdW0uY29tL3wyMzRCNkQ1My1GOTNELTRERDAtOTgxNS0yRkJBMEVEQUVDN0U=",\
    "name": "Kame-1",\
    "description": "Complete multi-board Kame Drone device assembly."\
   \},\
   \{\
    "id": "RGVzUHJvamVjdApkaHR0cHM6Ly9uZXhhci1kZW1vLjM2NS5hbHRpdW0uY29tL3w0MEFCRjIxOS1BRjM0LTRENzYtQTQ5OC1ENDI2OURDMjQ1MUM=",\
    "name": "Kame_FMU - Copy to demo progress",\
    "description": "Managed project cloned from Kame_FMU"\
   \},\
...

The content returned from the workspace may be easily tailored by editing the query string in the example code. Please pay particular attention to the "id" field within "projects" as this id will be used for several of the project related examples.

## Examining the BOM from an A365 project
The project_BOM.py example is a query that uses the project id to identify the BOM source in the A365 workspace:

`python workspace_info.py -t $token <project_id>`

The project id is static across Nexar sessions and contains all of the information needed to identify the correct workspace and design data.  This example is important to inspect to understand how the Nexar query can be used to get design information from either the current version of the design (labeled workInProgress in our schema) or from a specific version labeled for a release.  Additionally, each design may contain variants that will be a unique configuration of the design components.
